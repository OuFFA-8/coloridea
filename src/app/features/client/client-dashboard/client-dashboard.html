<!-- Loading -->
@if (isLoading) {
  <div class="min-h-screen bg-[#fff1e6] dark:bg-[#0e0e0e] flex items-center justify-center">
    <div class="text-center">
      <div
        class="w-12 h-12 border-4 border-[#fa8728]/30 border-t-[#fa8728] rounded-full animate-spin mx-auto mb-4"
      ></div>
      <p
        class="text-[10px] font-black uppercase tracking-widest text-[#5c5f63]/40 dark:text-gray-600"
      >
        {{ 'COMMON.LOADING' | translate }}
      </p>
    </div>
  </div>
}

@if (!isLoading) {
  <div class="min-h-screen bg-[#fff1e6] dark:bg-[#0e0e0e] transition-colors duration-500">
    <!-- ===== HERO HEADER ===== -->
    <div
      class="relative bg-white dark:bg-[#1c1c1c] border-b border-[#e6d5c3] dark:border-[#444547]/30 px-8 py-10 ci-section"
      style="--delay: 0s"
    >
      <div class="max-w-6xl mx-auto flex items-center justify-between gap-6">
        <div class="flex items-center gap-5">
          @if (user?.logo || user?.photo) {
            <div
              class="w-16 h-16 rounded-2xl overflow-hidden border-2 border-[#e6d5c3] dark:border-[#444547]/30 shadow-lg bg-white dark:bg-[#1c1c1c] flex-shrink-0"
            >
              <img
                [src]="getPhotoUrl(user.logo || user.photo)"
                [alt]="user.name"
                class="w-full h-full object-contain"
                (error)="$any($event.target).style.display = 'none'"
              />
            </div>
          }
          <div>
            <p
              class="text-[10px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500 mb-1"
              style="font-family: 'Alexandria', sans-serif"
            >
              {{ 'CLIENT.DASHBOARD.WELCOME' | translate }}
            </p>
            <h1
              class="text-3xl font-black text-[#444547] dark:text-white tracking-tight"
              style="font-family: 'Alexandria', sans-serif"
            >
              {{ user?.name }}
            </h1>
            <p
              class="text-sm text-[#5c5f63]/50 dark:text-gray-500 mt-1"
              style="font-family: 'Alexandria', sans-serif"
            >
              @if (projects.length === 0) {
                {{ 'CLIENT.DASHBOARD.NO_PROJECTS_ASSIGNED' | translate }}
              } @else {
                {{ projects.length }} {{ 'CLIENT.DASHBOARD.PROJECTS_ASSIGNED' | translate }}
              }
            </p>
          </div>
        </div>

        <!-- Stats -->
        @if (projects.length > 0) {
          <div class="hidden md:flex items-center gap-4">
            <div
              class="text-center px-6 py-3 rounded-2xl border bg-[#fff1e6] border-[#e6d5c3] dark:bg-[#444547]/10 dark:border-[#444547]/30"
            >
              <p
                class="text-2xl font-black text-[#444547] dark:text-white"
                style="font-family: 'Alexandria', sans-serif"
              >
                {{ projects.length }}
              </p>
              <p
                class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500 mt-0.5"
              >
                {{ 'ADMIN.PROJECTS.TITLE' | translate }}
              </p>
            </div>
            <div
              class="text-center px-6 py-3 rounded-2xl border bg-[#fa8728]/8 border-[#fa8728]/20 dark:bg-[#fa8728]/10 dark:border-[#fa8728]/20"
            >
              <p
                class="text-2xl font-black text-[#fa8728]"
                style="font-family: 'Alexandria', sans-serif"
              >
                {{ activeCount }}
              </p>
              <p class="text-[9px] font-black uppercase tracking-widest text-[#fa8728]/70 mt-0.5">
                {{ 'STATUS.ACTIVE' | translate }}
              </p>
            </div>
            <div
              class="text-center px-6 py-3 rounded-2xl border bg-[#68ab1f]/8 border-[#68ab1f]/20 dark:bg-[#68ab1f]/10 dark:border-[#68ab1f]/20"
            >
              <p
                class="text-2xl font-black text-[#68ab1f]"
                style="font-family: 'Alexandria', sans-serif"
              >
                {{ completedCount }}
              </p>
              <p class="text-[9px] font-black uppercase tracking-widest text-[#68ab1f]/70 mt-0.5">
                {{ 'STATUS.COMPLETED' | translate }}
              </p>
            </div>
          </div>
        }
      </div>
    </div>

    <div class="max-w-6xl mx-auto px-8 py-10">
      <!-- Empty -->
      @if (projects.length === 0) {
        <div
          class="py-32 text-center border-2 border-dashed border-[#e6d5c3] dark:border-[#444547]/30 rounded-3xl ci-section"
          style="--delay: 0.08s"
        >
          <div class="text-5xl mb-4 opacity-20">üìÇ</div>
          <h2
            class="text-sm font-black uppercase tracking-widest text-[#5c5f63]/40 dark:text-gray-600 mb-2"
          >
            {{ 'CLIENT.DASHBOARD.NO_PROJECTS' | translate }}
          </h2>
          <p class="text-xs text-[#5c5f63]/30 dark:text-gray-700">
            {{ 'CLIENT.DASHBOARD.NO_PROJECTS_HINT' | translate }}
          </p>
        </div>
      }

      <!-- Projects List -->
      @if (projects.length > 0) {
        <div class="space-y-6 ci-section" style="--delay: 0.08s">
          @for (project of projects; track project._id) {
            <div
              (click)="openProject(project._id)"
              class="ci-card group bg-white dark:bg-[#1c1c1c] rounded-3xl border border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm cursor-pointer overflow-hidden"
            >
              <div class="flex flex-col md:flex-row">
                <!-- Image -->
                <div
                  class="md:w-64 h-48 md:h-auto bg-[#e6d5c3]/30 dark:bg-[#444547]/20 overflow-hidden relative flex-shrink-0"
                >
                  @if (project.photo) {
                    <img
                      [src]="getPhotoUrl(project.photo)"
                      [alt]="project.name"
                      class="ci-card-img w-full h-full object-cover"
                    />
                  } @else {
                    <div class="w-full h-full flex items-center justify-center">
                      <span class="text-5xl opacity-10">üèóÔ∏è</span>
                    </div>
                  }
                  <!-- Status -->
                  <div class="absolute top-4 left-4">
                    <span
                      class="px-3 py-1 rounded-xl text-[9px] font-black uppercase tracking-widest backdrop-blur-sm"
                      [class.bg-[#fa8728]/90]="project.status === 'active'"
                      [class.text-white]="project.status === 'active'"
                      [class.bg-[#68ab1f]/90]="project.status === 'completed'"
                      [class.text-white]="project.status === 'completed'"
                      [class.bg-black/50]="project.status === 'pending' || !project.status"
                      [class.text-white/80]="project.status === 'pending' || !project.status"
                    >
                      {{ 'STATUS.' + (project.status?.toUpperCase() || 'PENDING') | translate }}
                    </span>
                  </div>
                </div>

                <!-- Content -->
                <div class="flex-1 p-7 flex flex-col justify-between">
                  <div>
                    <div class="flex items-start justify-between gap-4 mb-3">
                      <h3
                        class="text-xl font-black text-[#444547] dark:text-white group-hover:text-[#fa8728] transition-colors duration-300"
                        style="font-family: 'Alexandria', sans-serif"
                      >
                        {{ project.name }}
                      </h3>
                      <span class="text-[10px] font-black text-[#fa8728] flex-shrink-0 mt-1">
                        {{ 'COMMON.OPEN' | translate }} ‚Üí
                      </span>
                    </div>
                    @if (project.description) {
                      <p
                        class="text-sm text-[#5c5f63]/50 dark:text-gray-500 mb-5 line-clamp-2"
                        style="font-family: 'Alexandria', sans-serif"
                      >
                        "{{ project.description }}"
                      </p>
                    }
                  </div>

                  <!-- Outputs -->
                  @if (project.outputs?.length > 0) {
                    <div class="mb-5">
                      <p
                        class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/40 dark:text-gray-600 mb-3"
                      >
                        {{ 'CLIENT.DELIVERABLES.TITLE' | translate }}
                      </p>
                      <div class="flex flex-wrap gap-2">
                        @for (output of project.outputs; track output._id) {
                          <div
                            class="flex items-center gap-2 px-3 py-1.5 rounded-xl border bg-[#fff1e6] border-[#e6d5c3] dark:bg-[#444547]/10 dark:border-[#444547]/20"
                          >
                            <div
                              class="w-1.5 h-1.5 rounded-full flex-shrink-0"
                              [class.bg-[#68ab1f]]="output.items?.length >= output.numberOfItems"
                              [class.bg-[#fa8728]]="
                                output.items?.length < output.numberOfItems &&
                                output.items?.length > 0
                              "
                              [class.bg-[#e6d5c3]]="!output.items?.length"
                            ></div>
                            <span
                              class="text-[10px] font-bold text-[#5c5f63]/70 dark:text-gray-400"
                              style="font-family: 'Alexandria', sans-serif"
                              >{{ output.name }}</span
                            >
                            <span
                              class="text-[9px] font-black text-[#5c5f63]/40 dark:text-gray-600"
                            >
                              {{ output.items?.length || 0 }}/{{ output.numberOfItems }}
                            </span>
                          </div>
                        }
                      </div>
                    </div>
                  }

                  <!-- Footer -->
                  <div
                    class="flex items-center justify-between pt-4 border-t border-[#e6d5c3]/60 dark:border-[#444547]/20 gap-4"
                  >
                    @if (project.financialDetails) {
                      <div class="flex items-center gap-4">
                        <div>
                          <p
                            class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/40 dark:text-gray-600"
                          >
                            {{ 'CLIENT.FINANCIALS.TOTAL_CONTRACT' | translate }}
                          </p>
                          <p
                            class="text-base font-black text-[#444547] dark:text-white"
                            style="font-family: 'Alexandria', sans-serif"
                          >
                            {{ project.financialDetails.totalAmount
                            }}<svg
                              xmlns="http://www.w3.org/2000/svg"
                              width="14"
                              height="14"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              class="inline-block align-middle -mt-0.5"
                            >
                              <path d="m20 19.5-5.5 1.2" />
                              <path d="M14.5 4v11.22a1 1 0 0 0 1.242.97L20 15.2" />
                              <path d="m2.978 19.351 5.549-1.363A2 2 0 0 0 10 16V2" />
                              <path d="M20 10 4 13.5" />
                            </svg>
                          </p>
                        </div>
                        <div class="w-px h-8 bg-[#e6d5c3] dark:bg-[#444547]/30"></div>
                        <div>
                          <p class="text-[9px] font-black uppercase tracking-widest text-[#68ab1f]">
                            {{ 'CLIENT.FINANCIALS.PAID' | translate }}
                          </p>
                          <p
                            class="text-base font-black text-[#68ab1f]"
                            style="font-family: 'Alexandria', sans-serif"
                          >
                            {{ project.financialDetails.paidInstallments }}/{{
                              project.financialDetails.totalInstallments
                            }}
                          </p>
                        </div>
                        <div class="w-px h-8 bg-[#e6d5c3] dark:bg-[#444547]/30"></div>
                        <div class="flex items-center gap-2">
                          <div
                            class="w-24 h-1.5 bg-[#e6d5c3]/60 dark:bg-[#444547]/20 rounded-full overflow-hidden"
                          >
                            <div
                              class="h-full bg-[#68ab1f] rounded-full transition-all duration-700"
                              [style.width.%]="
                                project.financialDetails.totalInstallments
                                  ? (project.financialDetails.paidInstallments /
                                      project.financialDetails.totalInstallments) *
                                    100
                                  : 0
                              "
                            ></div>
                          </div>
                          <span class="text-[9px] font-black text-[#5c5f63]/40 dark:text-gray-600">
                            {{
                              project.financialDetails.totalInstallments
                                ? (
                                    (project.financialDetails.paidInstallments /
                                      project.financialDetails.totalInstallments) *
                                    100
                                  ).toFixed(0)
                                : 0
                            }}%
                          </span>
                        </div>
                      </div>
                    }
                    <span
                      class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/30 dark:text-gray-700 ml-auto"
                    >
                      {{ project.outputs?.length || 0 }} {{ 'ADMIN.PROJECTS.OUTPUTS' | translate }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
}
