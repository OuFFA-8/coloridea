<!-- Loading -->
@if (isLoading) {
  <div class="min-h-screen bg-[#fff1e6] dark:bg-[#0e0e0e] flex items-center justify-center">
    <div class="text-center">
      <div
        class="w-12 h-12 border-4 border-[#fa8728]/30 border-t-[#fa8728] rounded-full animate-spin mx-auto mb-4"
      ></div>
      <p
        class="text-[10px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500"
      >
        {{ 'CLIENT.SELECT.LOADING' | translate }}
      </p>
    </div>
  </div>
}

@if (!isLoading) {
  <div class="min-h-screen bg-[#fff1e6] dark:bg-[#0e0e0e] flex flex-col">
    <!-- ===== TOP BAR ===== -->
    <div
      class="flex items-center justify-between px-8 py-5 border-b border-[#e6d5c3] dark:border-[#444547]/30"
    >
      <div class="flex items-center gap-3">
        @if (user?.logo || user?.photo) {
          <div
            class="w-9 h-9 rounded-xl overflow-hidden border border-[#e6d5c3] dark:border-[#444547]/40 bg-white dark:bg-[#1c1c1c]"
          >
            <img
              [src]="getPhotoUrl(user.logo || user.photo)"
              [alt]="user.name"
              class="w-full h-full object-contain"
              (error)="$any($event.target).style.display = 'none'"
            />
          </div>
        }
        <div>
          <p
            class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/40 dark:text-gray-600"
            style="font-family: 'Alexandria', sans-serif"
          >
            {{ 'CLIENT.SELECT.LOGGED_IN_AS' | translate }}
          </p>
          <p
            class="text-sm font-black text-[#444547] dark:text-white"
            style="font-family: 'Alexandria', sans-serif"
          >
            {{ user?.name }}
          </p>
        </div>
      </div>
      <button
        (click)="logout()"
        class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest cursor-pointer transition-all border text-[#5c5f63]/50 dark:text-gray-500 hover:text-rose-400 bg-white dark:bg-[#1c1c1c] border-[#e6d5c3] dark:border-[#444547]/30 hover:border-rose-500/30"
      >
        {{ 'NAV.LOGOUT' | translate }}
      </button>
    </div>

    <!-- ===== CONTENT ===== -->
    <div class="flex-1 flex flex-col items-center justify-center px-6 py-16">
      <!-- Header -->
      <div class="text-center mb-12 ci-section" style="--delay: 0s">
        <p
          class="text-[10px] font-black uppercase tracking-[0.3em] text-[#fa8728] mb-3"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ 'CLIENT.SELECT.WELCOME' | translate }}
        </p>
        <h1
          class="text-4xl font-black text-[#444547] dark:text-white tracking-tight mb-3"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ 'CLIENT.SELECT.TITLE_LINE1' | translate }}<br />
          {{ 'CLIENT.SELECT.TITLE_LINE2' | translate }}
        </h1>
        <p
          class="text-sm text-[#5c5f63]/50 dark:text-gray-500 font-medium"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ projects.length }} {{ 'CLIENT.SELECT.PROJECTS_COUNT' | translate }}
        </p>
      </div>

      <!-- Projects Grid -->
      <div
        class="w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 ci-section"
        style="--delay: 0.08s"
      >
        @for (project of projects; track project._id) {
          <div
            (click)="selectProject(project)"
            class="ci-card group relative bg-white dark:bg-[#1c1c1c] rounded-3xl border border-[#e6d5c3] dark:border-[#444547]/30 shadow-xl cursor-pointer overflow-hidden"
          >
            <!-- Image -->
            <div class="w-full h-40 bg-[#e6d5c3]/40 dark:bg-[#444547]/20 overflow-hidden relative">
              @if (project.photo) {
                <img
                  [src]="getPhotoUrl(project.photo)"
                  [alt]="project.name"
                  class="ci-card-img w-full h-full object-cover"
                  (error)="$any($event.target).style.display = 'none'"
                />
              } @else {
                <div class="w-full h-full flex items-center justify-center">
                  <span class="text-5xl opacity-10">üèóÔ∏è</span>
                </div>
              }
              <div
                class="absolute inset-0 bg-gradient-to-t from-black/20 dark:from-[#1c1c1c] via-transparent to-transparent"
              ></div>
              <!-- Status -->
              <div class="absolute top-3 right-3">
                <span
                  class="px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest backdrop-blur-sm"
                  [class.bg-[#fa8728]/80]="project.status === 'active'"
                  [class.text-white]="project.status === 'active'"
                  [class.bg-[#68ab1f]/80]="project.status === 'completed'"
                  [class.text-white]="project.status === 'completed'"
                  [class.bg-[#444547]/80]="project.status === 'pending' || !project.status"
                  [class.text-gray-300]="project.status === 'pending' || !project.status"
                >
                  {{ 'STATUS.' + (project.status?.toUpperCase() || 'PENDING') | translate }}
                </span>
              </div>
            </div>

            <!-- Body -->
            <div class="p-5">
              <h3
                class="text-base font-black text-[#444547] dark:text-white mb-1 truncate transition-colors duration-300 group-hover:text-[#fa8728]"
                style="font-family: 'Alexandria', sans-serif"
              >
                {{ project.name }}
              </h3>
              @if (project.description) {
                <p
                  class="text-xs text-[#5c5f63]/50 dark:text-gray-500 truncate mb-4"
                  style="font-family: 'Alexandria', sans-serif"
                >
                  {{ project.description }}
                </p>
              }

              <!-- Output tags -->
              @if (project.outputs?.length > 0) {
                <div class="flex flex-wrap gap-1.5 mb-4">
                  @for (output of project.outputs.slice(0, 2); track output._id) {
                    <span
                      class="text-[9px] font-bold px-2 py-1 rounded-lg truncate max-w-[100px] bg-[#e6d5c3]/60 dark:bg-[#444547]/30 border border-[#e6d5c3] dark:border-[#444547]/40 text-[#5c5f63]/50 dark:text-gray-500"
                    >
                      {{ output.name }}
                    </span>
                  }
                  @if (project.outputs.length > 2) {
                    <span
                      class="text-[9px] font-bold px-2 py-1 rounded-lg bg-[#fa8728]/15 text-[#fa8728] border border-[#fa8728]/20"
                    >
                      +{{ project.outputs.length - 2 }}
                    </span>
                  }
                </div>
              }

              <div
                class="flex items-center justify-between pt-4 border-t border-[#e6d5c3]/60 dark:border-[#444547]/25"
              >
                <span
                  class="text-[9px] font-black text-[#5c5f63]/30 dark:text-gray-700 uppercase tracking-wider"
                >
                  {{ project.outputs?.length || 0 }} {{ 'ADMIN.PROJECTS.OUTPUTS' | translate }}
                </span>
                <span class="text-[10px] font-black text-[#fa8728] transition-colors">
                  {{ 'CLIENT.SELECT.ENTER' | translate }} ‚Üí
                </span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}
