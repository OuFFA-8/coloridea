<!-- Loading -->
@if (isLoading) {
  <div class="min-h-screen flex items-center justify-center bg-[#fff1e6] dark:bg-[#0e0e0e]">
    <div
      class="w-10 h-10 border-4 border-[#fa8728]/30 border-t-[#fa8728] rounded-full animate-spin"
    ></div>
  </div>
}

@if (!isLoading) {
  <div class="p-8 space-y-8 min-h-screen bg-transparent transition-colors duration-500">
    <!-- ===== HEADER ===== -->
    <div class="ci-section" style="--delay: 0s">
      <h1
        class="text-3xl font-black tracking-tight text-[#444547] dark:text-white"
        style="font-family: 'Alexandria', sans-serif"
      >
        {{ 'CLIENT.FINANCIALS.TITLE' | translate }}
      </h1>
      <p
        class="text-[10px] font-bold uppercase tracking-[0.3em] text-[#5c5f63]/50 dark:text-gray-500 mt-1"
        style="font-family: 'Alexandria', sans-serif"
      >
        {{ 'CLIENT.FINANCIALS.SUBTITLE' | translate }}
      </p>
    </div>

    <!-- ===== STATS CARDS ===== -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-5 ci-section" style="--delay: 0.06s">
      <!-- Total -->
      <div
        class="p-7 rounded-3xl relative overflow-hidden shadow-sm bg-white border border-[#e6d5c3] dark:bg-[#1c1c1c] dark:border-[#444547]/30"
      >
        <div class="absolute -right-3 -bottom-3 text-5xl opacity-5">üí∞</div>
        <p
          class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500 mb-2"
        >
          {{ 'CLIENT.FINANCIALS.TOTAL_CONTRACT' | translate }}
        </p>
        <p
          class="text-4xl font-black text-[#444547] dark:text-white tracking-tight"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ totalAmount | number }}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="inline-block align-middle -mt-0.5"
          >
            <path d="m20 19.5-5.5 1.2" />
            <path d="M14.5 4v11.22a1 1 0 0 0 1.242.97L20 15.2" />
            <path d="m2.978 19.351 5.549-1.363A2 2 0 0 0 10 16V2" />
            <path d="M20 10 4 13.5" />
          </svg>
        </p>
      </div>

      <!-- Paid -->
      <div
        class="p-7 rounded-3xl relative overflow-hidden shadow-sm bg-[#68ab1f]/8 border border-[#68ab1f]/20 dark:bg-[#68ab1f]/10 dark:border-[#68ab1f]/20"
      >
        <div class="absolute -right-3 -bottom-3 text-5xl opacity-10">‚úÖ</div>
        <p class="text-[9px] font-black uppercase tracking-widest text-[#68ab1f] mb-2">
          {{ 'CLIENT.FINANCIALS.TOTAL_PAID' | translate }}
        </p>
        <p
          class="text-4xl font-black text-[#68ab1f] tracking-tight"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ paidAmount | number }}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="inline-block align-middle -mt-0.5"
          >
            <path d="m20 19.5-5.5 1.2" />
            <path d="M14.5 4v11.22a1 1 0 0 0 1.242.97L20 15.2" />
            <path d="m2.978 19.351 5.549-1.363A2 2 0 0 0 10 16V2" />
            <path d="M20 10 4 13.5" />
          </svg>
        </p>
      </div>

      <!-- Remaining -->
      <div
        class="p-7 rounded-3xl relative overflow-hidden shadow-sm bg-rose-50 border border-rose-100 dark:bg-rose-500/10 dark:border-rose-500/15"
      >
        <div class="absolute -right-3 -bottom-3 text-5xl opacity-10">‚è≥</div>
        <p class="text-[9px] font-black uppercase tracking-widest text-rose-400 mb-2">
          {{ 'CLIENT.FINANCIALS.REMAINING' | translate }}
        </p>
        <p
          class="text-4xl font-black text-rose-500 dark:text-rose-400 tracking-tight"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ remainingAmount | number }}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="inline-block align-middle -mt-0.5"
          >
            <path d="m20 19.5-5.5 1.2" />
            <path d="M14.5 4v11.22a1 1 0 0 0 1.242.97L20 15.2" />
            <path d="m2.978 19.351 5.549-1.363A2 2 0 0 0 10 16V2" />
            <path d="M20 10 4 13.5" />
          </svg>
        </p>
      </div>
    </div>

    <!-- ===== PROGRESS ===== -->
    <div
      class="bg-white dark:bg-[#1c1c1c] rounded-3xl border border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm p-7 ci-section"
      style="--delay: 0.1s"
    >
      <div class="flex justify-between items-center mb-4">
        <p
          class="text-[10px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500"
        >
          {{ 'CLIENT.FINANCIALS.PAYMENT_PROGRESS' | translate }}
        </p>
        <span
          class="text-2xl font-black text-[#68ab1f]"
          style="font-family: 'Alexandria', sans-serif"
          >{{ paymentProgress }}%</span
        >
      </div>
      <div class="h-4 bg-[#e6d5c3]/50 dark:bg-[#444547]/20 rounded-full overflow-hidden">
        <div
          class="h-full bg-gradient-to-r from-[#68ab1f] to-[#8bc34a] rounded-full transition-all duration-1000"
          [style.width.%]="paymentProgress"
        ></div>
      </div>
      <div class="flex justify-between mt-3">
        <span class="text-[10px] font-bold text-[#5c5f63]/50 dark:text-gray-500">
          {{ financialDetails.paidInstallments || 0 }} {{ 'CLIENT.FINANCIALS.OF' | translate }}
          {{ financialDetails.totalInstallments || 0 }}
          {{ 'CLIENT.FINANCIALS.INSTALLMENTS_PAID' | translate }}
        </span>
        <span class="text-[10px] font-bold text-rose-400">
          {{ financialDetails.remainingInstallments || 0 }}
          {{ 'CLIENT.FINANCIALS.REMAINING_SHORT' | translate }}
        </span>
      </div>
    </div>

    <!-- ===== INSTALLMENTS TABLE ===== -->
    <div
      class="bg-white dark:bg-[#1c1c1c] rounded-3xl border border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm overflow-hidden ci-section"
      style="--delay: 0.14s"
    >
      <div
        class="px-7 py-5 border-b border-[#e6d5c3]/60 dark:border-[#444547]/20 flex justify-between items-center"
      >
        <h2
          class="text-xs font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500"
        >
          {{ 'CLIENT.FINANCIALS.PAYMENT_SCHEDULE' | translate }}
        </h2>
        <span class="text-[9px] font-bold text-[#5c5f63]/30 dark:text-gray-700">
          {{ 'CLIENT.FINANCIALS.CURRENCY_NOTE' | translate }}
        </span>
      </div>

      @if (installments.length === 0) {
        <div class="py-16 text-center">
          <p
            class="text-[10px] font-black uppercase tracking-widest text-[#5c5f63]/30 dark:text-gray-700"
          >
            {{ 'CLIENT.FINANCIALS.NO_PAYMENTS' | translate }}
          </p>
        </div>
      }

      <div class="divide-y divide-[#e6d5c3]/40 dark:divide-[#444547]/20">
        @for (inst of installments; track inst._id; let i = $index) {
          <div class="ci-row group flex items-center justify-between px-7 py-5">
            <div class="flex items-center gap-5">
              <div
                class="w-10 h-10 rounded-xl flex items-center justify-center font-black text-xs flex-shrink-0 bg-[#68ab1f]/10 text-[#68ab1f] dark:bg-[#68ab1f]/15"
              >
                {{ i + 1 }}
              </div>
              <div>
                <p
                  class="font-black text-sm text-[#444547] dark:text-white"
                  style="font-family: 'Alexandria', sans-serif"
                >
                  {{ 'CLIENT.FINANCIALS.INSTALLMENT' | translate }} #{{ i + 1 }}
                </p>
                <p
                  class="text-[10px] font-bold text-[#5c5f63]/50 dark:text-gray-500 uppercase tracking-widest"
                >
                  {{ inst.createdAt | date: 'dd MMM yyyy' }}
                </p>
              </div>
            </div>
            <div class="text-right">
              <p
                class="text-xl font-black text-[#68ab1f]"
                style="font-family: 'Alexandria', sans-serif"
              >
                {{ inst.amount | number }}
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="inline-block align-middle -mt-0.5"
                >
                  <path d="m20 19.5-5.5 1.2" />
                  <path d="M14.5 4v11.22a1 1 0 0 0 1.242.97L20 15.2" />
                  <path d="m2.978 19.351 5.549-1.363A2 2 0 0 0 10 16V2" />
                  <path d="M20 10 4 13.5" />
                </svg>
              </p>
              <div class="flex items-center gap-1.5 justify-end mt-0.5">
                <span class="w-1.5 h-1.5 rounded-full bg-[#68ab1f]"></span>
                <span class="text-[9px] font-black uppercase tracking-widest text-[#68ab1f]">
                  {{ 'CLIENT.FINANCIALS.PAID' | translate }}
                </span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}
