<!-- Loading -->
@if (isLoading) {
  <div class="min-h-screen flex items-center justify-center bg-[#fff1e6] dark:bg-[#0e0e0e]">
    <div
      class="w-10 h-10 border-4 border-[#fa8728]/30 border-t-[#fa8728] rounded-full animate-spin"
    ></div>
  </div>
}

@if (!isLoading && project) {
  <div class="p-8 space-y-8 min-h-screen bg-transparent transition-colors duration-500">
    <!-- ===== HEADER ===== -->
    <div
      class="flex flex-col md:flex-row md:items-center justify-between gap-6 ci-section"
      style="--delay: 0s"
    >
      <div>
        <div
          class="flex items-center gap-2 mb-2 text-[10px] font-bold uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500"
        >
          <a
            routerLink="/client/projects"
            class="hover:text-[#fa8728] no-underline transition-colors"
          >
            {{ 'ADMIN.PROJECTS.TITLE' | translate }}
          </a>
          <span>/</span>
          <span class="text-[#fa8728]">{{ 'CLIENT.PROJECT_DETAILS.OVERVIEW' | translate }}</span>
        </div>
        <h1
          class="text-3xl font-black tracking-tight text-[#444547] dark:text-white"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ project.name }}
        </h1>
        @if (project.description) {
          <p
            class="text-sm text-[#5c5f63]/50 dark:text-gray-500 mt-1 italic"
            style="font-family: 'Alexandria', sans-serif"
          >
            "{{ project.description }}"
          </p>
        }
      </div>
      <span
        class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest self-start md:self-center"
        [class.bg-[#fa8728]/10]="project.status === 'active'"
        [class.text-[#fa8728]]="project.status === 'active'"
        [class.bg-[#68ab1f]/10]="project.status === 'completed'"
        [class.text-[#68ab1f]]="project.status === 'completed'"
        [class.bg-[#e6d5c3]/60]="project.status === 'pending' || !project.status"
        [class.text-[#5c5f63]/50]="project.status === 'pending' || !project.status"
        [class.dark:bg-[#444547]/20]="project.status === 'pending' || !project.status"
        [class.dark:text-gray-500]="project.status === 'pending' || !project.status"
      >
        {{ 'STATUS.' + (project.status?.toUpperCase() || 'PENDING') | translate }}
      </span>
    </div>

    <!-- ===== STATS GRID ===== -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 ci-section" style="--delay: 0.06s">
      <!-- Outputs Progress -->
      <div
        class="col-span-2 lg:col-span-2 p-7 rounded-3xl shadow-sm bg-white border border-[#e6d5c3] dark:bg-[#1c1c1c] dark:border-[#444547]/30"
      >
        <p
          class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500 mb-1"
        >
          {{ 'CLIENT.PROJECT_DETAILS.OUTPUTS_PROGRESS' | translate }}
        </p>
        <div class="flex items-end justify-between mb-4">
          <span
            class="text-5xl font-black text-[#444547] dark:text-white"
            style="font-family: 'Alexandria', sans-serif"
            >{{ outputsProgress }}</span
          >
          <span class="text-2xl font-black text-[#fa8728] mb-1">%</span>
        </div>
        <div class="h-3 bg-[#e6d5c3]/50 dark:bg-[#444547]/20 rounded-full overflow-hidden">
          <div
            class="h-full bg-gradient-to-r from-[#fa8728] to-[#f97316] rounded-full transition-all duration-1000"
            [style.width.%]="outputsProgress"
          ></div>
        </div>
        <p class="text-[10px] font-bold text-[#5c5f63]/50 dark:text-gray-500 mt-2">
          {{ deliveredItems }} {{ 'CLIENT.PROJECT_DETAILS.OF' | translate }} {{ totalItems }}
          {{ 'CLIENT.PROJECT_DETAILS.ITEMS_DELIVERED' | translate }}
        </p>
      </div>

      <!-- Payment Progress -->
      <div
        class="col-span-2 lg:col-span-2 p-7 rounded-3xl shadow-sm bg-white border border-[#e6d5c3] dark:bg-[#1c1c1c] dark:border-[#444547]/30"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-[#68ab1f] mb-1">
          {{ 'CLIENT.FINANCIALS.PAYMENT_PROGRESS' | translate }}
        </p>
        <div class="flex items-end justify-between mb-4">
          <span
            class="text-5xl font-black text-[#444547] dark:text-white"
            style="font-family: 'Alexandria', sans-serif"
            >{{ paymentProgress }}</span
          >
          <span class="text-2xl font-black text-[#68ab1f] mb-1">%</span>
        </div>
        <div class="h-3 bg-[#e6d5c3]/50 dark:bg-[#444547]/20 rounded-full overflow-hidden">
          <div
            class="h-full bg-gradient-to-r from-[#68ab1f] to-[#8bc34a] rounded-full transition-all duration-1000"
            [style.width.%]="paymentProgress"
          ></div>
        </div>
        <p class="text-[10px] font-bold text-[#5c5f63]/50 dark:text-gray-500 mt-2">
          {{ project.financialDetails?.paidInstallments || 0 }}
          {{ 'CLIENT.FINANCIALS.OF' | translate }}
          {{ project.financialDetails?.totalInstallments || 0 }}
          {{ 'CLIENT.FINANCIALS.INSTALLMENTS_PAID' | translate }}
        </p>
      </div>

      <!-- Total -->
      <div
        class="p-6 rounded-2xl shadow-sm text-center bg-white border border-[#e6d5c3] dark:bg-[#1c1c1c] dark:border-[#444547]/30"
      >
        <p
          class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500 mb-2"
        >
          {{ 'CLIENT.FINANCIALS.TOTAL_CONTRACT' | translate }}
        </p>
        <p
          class="text-2xl font-black text-[#444547] dark:text-white"
          style="font-family: 'Alexandria', sans-serif"
        >
          ${{ project.financialDetails?.totalAmount || 0 }}
        </p>
      </div>

      <!-- Paid -->
      <div
        class="p-6 rounded-2xl shadow-sm text-center bg-[#68ab1f]/8 border border-[#68ab1f]/20 dark:bg-[#68ab1f]/10 dark:border-[#68ab1f]/20"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-[#68ab1f] mb-2">
          {{ 'CLIENT.FINANCIALS.TOTAL_PAID' | translate }}
        </p>
        <p class="text-2xl font-black text-[#68ab1f]" style="font-family: 'Alexandria', sans-serif">
          ${{ paidAmount }}
        </p>
      </div>

      <!-- Remaining -->
      <div
        class="p-6 rounded-2xl shadow-sm text-center bg-rose-50 border border-rose-100 dark:bg-rose-500/10 dark:border-rose-500/15"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-rose-400 mb-2">
          {{ 'CLIENT.FINANCIALS.REMAINING' | translate }}
        </p>
        <p
          class="text-2xl font-black text-rose-500 dark:text-rose-400"
          style="font-family: 'Alexandria', sans-serif"
        >
          ${{ remainingAmount }}
        </p>
      </div>

      <!-- Outputs Count -->
      <div
        class="p-6 rounded-2xl shadow-sm text-center bg-[#fa8728]/8 border border-[#fa8728]/20 dark:bg-[#fa8728]/10 dark:border-[#fa8728]/20"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-[#fa8728] mb-2">
          {{ 'ADMIN.PROJECTS.OUTPUTS' | translate }}
        </p>
        <p class="text-2xl font-black text-[#fa8728]" style="font-family: 'Alexandria', sans-serif">
          {{ project.outputs?.length || 0 }}
        </p>
      </div>
    </div>

    <!-- ===== OUTPUTS SUMMARY ===== -->
    @if (project.outputs?.length > 0) {
      <div
        class="bg-white dark:bg-[#1c1c1c] rounded-3xl border border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm overflow-hidden ci-section"
        style="--delay: 0.1s"
      >
        <div class="px-7 py-5 border-b border-[#e6d5c3]/60 dark:border-[#444547]/20">
          <h2
            class="text-xs font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500"
          >
            {{ 'CLIENT.PROJECT_DETAILS.OUTPUTS_SUMMARY' | translate }}
          </h2>
        </div>
        <div class="divide-y divide-[#e6d5c3]/40 dark:divide-[#444547]/20">
          @for (output of project.outputs; track output._id) {
            <div
              class="flex items-center justify-between px-7 py-4 transition-colors duration-200 hover:bg-[#fa8728]/4 dark:hover:bg-[#fa8728]/4"
            >
              <div class="flex items-center gap-3">
                <div
                  class="w-2 h-2 rounded-full flex-shrink-0"
                  [class.bg-[#68ab1f]]="output.items?.length >= output.numberOfItems"
                  [class.bg-[#fa8728]]="
                    output.items?.length > 0 && output.items?.length < output.numberOfItems
                  "
                  [class.bg-[#e6d5c3]]="!output.items?.length"
                ></div>
                <span class="text-sm font-bold text-[#444547] dark:text-gray-300">{{
                  output.name
                }}</span>
              </div>
              <div class="flex items-center gap-4">
                <div
                  class="w-24 h-1.5 bg-[#e6d5c3]/60 dark:bg-[#444547]/20 rounded-full overflow-hidden"
                >
                  <div
                    class="h-full bg-[#fa8728] rounded-full transition-all duration-700"
                    [style.width.%]="
                      output.numberOfItems
                        ? ((output.items?.length || 0) / output.numberOfItems) * 100
                        : 0
                    "
                  ></div>
                </div>
                <span
                  class="text-[10px] font-black text-[#5c5f63]/50 dark:text-gray-500 w-12 text-right"
                >
                  {{ output.items?.length || 0 }}/{{ output.numberOfItems }}
                </span>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- ===== CHARTS ===== -->
    <div class="grid lg:grid-cols-2 gap-6 ci-section" style="--delay: 0.14s">
      <div
        class="p-8 rounded-3xl border shadow-sm bg-white border-[#e6d5c3] dark:bg-[#1c1c1c] dark:border-[#444547]/30"
      >
        <app-chart-card
          [title]="'CLIENT.PROJECT_DETAILS.WORK_DISTRIBUTION' | translate"
          [type]="'doughnut'"
          [data]="pieData"
        >
        </app-chart-card>
      </div>
      <div
        class="p-8 rounded-3xl border shadow-sm bg-white border-[#e6d5c3] dark:bg-[#1c1c1c] dark:border-[#444547]/30"
      >
        <app-chart-card
          [title]="'CLIENT.PROJECT_DETAILS.OUTPUTS_DELIVERY' | translate"
          [type]="'line'"
          [data]="lineData"
        >
        </app-chart-card>
      </div>
    </div>
  </div>
}

@if (!isLoading && !project) {
  <div class="min-h-screen flex flex-col items-center justify-center gap-4">
    <div class="text-5xl opacity-20">üîç</div>
    <h2 class="text-sm font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500">
      {{ 'CLIENT.PROJECT_DETAILS.NOT_FOUND' | translate }}
    </h2>
    <a
      routerLink="/client/projects"
      class="px-6 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest no-underline text-white bg-[#fa8728] hover:bg-[#f97316] transition-colors"
    >
      ‚Üê {{ 'COMMON.BACK' | translate }}
    </a>
  </div>
}
