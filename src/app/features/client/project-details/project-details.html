<!-- Loading -->
@if (isLoading) {
  <div class="min-h-screen flex items-center justify-center bg-slate-50 dark:bg-[#0b0f1a]">
    <div
      class="w-10 h-10 border-4 border-blue-600/30 border-t-blue-600 rounded-full animate-spin"
    ></div>
  </div>
}

@if (!isLoading && project) {
  <div class="p-8 space-y-8 min-h-screen bg-transparent transition-colors duration-500">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
      <div>
        <div
          class="flex items-center gap-2 mb-2 text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 dark:text-gray-500"
        >
          <a
            routerLink="/client/projects"
            class="hover:text-blue-600 no-underline transition-colors"
            >Projects</a
          >
          <span>/</span>
          <span class="text-blue-600 dark:text-blue-500">Overview</span>
        </div>
        <h1 class="text-3xl font-black tracking-tight text-slate-900 dark:text-white">
          {{ project.name }}
        </h1>
        @if (project.description) {
          <p class="text-sm text-slate-400 dark:text-gray-500 mt-1 italic">
            "{{ project.description }}"
          </p>
        }
      </div>
      <span
        class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest self-start md:self-center"
        [class.bg-amber-100]="project.status === 'active'"
        [class.text-amber-700]="project.status === 'active'"
        [class.dark:bg-amber-900/20]="project.status === 'active'"
        [class.dark:text-amber-400]="project.status === 'active'"
        [class.bg-emerald-100]="project.status === 'completed'"
        [class.text-emerald-700]="project.status === 'completed'"
        [class.dark:bg-emerald-900/20]="project.status === 'completed'"
        [class.dark:text-emerald-400]="project.status === 'completed'"
        [class.bg-slate-100]="project.status === 'pending'"
        [class.text-slate-500]="project.status === 'pending'"
        [class.dark:bg-gray-800]="project.status === 'pending'"
        [class.dark:text-gray-400]="project.status === 'pending'"
      >
        {{ project.status || 'pending' }}
      </span>
    </div>

    <!-- ===== STATS GRID ===== -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- Outputs Progress -->
      <div
        class="col-span-2 lg:col-span-2 p-7 rounded-3xl bg-white dark:bg-[#111827] border border-slate-100 dark:border-gray-800 shadow-sm"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-slate-400 mb-1">
          Outputs Progress
        </p>
        <div class="flex items-end justify-between mb-4">
          <span class="text-5xl font-black text-slate-900 dark:text-white">{{
            outputsProgress
          }}</span>
          <span class="text-2xl font-black text-blue-600 mb-1">%</span>
        </div>
        <div class="h-3 bg-slate-100 dark:bg-gray-800 rounded-full overflow-hidden">
          <div
            class="h-full bg-gradient-to-r from-blue-600 to-indigo-400 rounded-full transition-all duration-1000"
            [style.width.%]="outputsProgress"
          ></div>
        </div>
        <p class="text-[10px] font-bold text-slate-400 mt-2">
          {{ deliveredItems }} of {{ totalItems }} items delivered
        </p>
      </div>

      <!-- Payment Progress -->
      <div
        class="col-span-2 lg:col-span-2 p-7 rounded-3xl bg-white dark:bg-[#111827] border border-slate-100 dark:border-gray-800 shadow-sm"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-emerald-500 mb-1">
          Payment Progress
        </p>
        <div class="flex items-end justify-between mb-4">
          <span class="text-5xl font-black text-slate-900 dark:text-white">{{
            paymentProgress
          }}</span>
          <span class="text-2xl font-black text-emerald-500 mb-1">%</span>
        </div>
        <div class="h-3 bg-slate-100 dark:bg-gray-800 rounded-full overflow-hidden">
          <div
            class="h-full bg-gradient-to-r from-emerald-500 to-green-400 rounded-full transition-all duration-1000"
            [style.width.%]="paymentProgress"
          ></div>
        </div>
        <p class="text-[10px] font-bold text-slate-400 mt-2">
          {{ project.financialDetails?.paidInstallments || 0 }} of
          {{ project.financialDetails?.totalInstallments || 0 }} installments paid
        </p>
      </div>

      <!-- Total Amount -->
      <div
        class="p-6 rounded-2xl bg-white dark:bg-[#111827] border border-slate-100 dark:border-gray-800 shadow-sm text-center"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-slate-400 mb-2">Total</p>
        <p class="text-2xl font-black text-slate-900 dark:text-white">
          ${{ project.financialDetails?.totalAmount || 0 }}
        </p>
      </div>

      <!-- Paid -->
      <div
        class="p-6 rounded-2xl bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800/30 shadow-sm text-center"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-emerald-500 mb-2">Paid</p>
        <p class="text-2xl font-black text-emerald-600 dark:text-emerald-400">${{ paidAmount }}</p>
      </div>

      <!-- Remaining -->
      <div
        class="p-6 rounded-2xl bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-800/30 shadow-sm text-center"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-red-400 mb-2">Remaining</p>
        <p class="text-2xl font-black text-red-500 dark:text-red-400">${{ remainingAmount }}</p>
      </div>

      <!-- Outputs Count -->
      <div
        class="p-6 rounded-2xl bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800/30 shadow-sm text-center"
      >
        <p class="text-[9px] font-black uppercase tracking-widest text-blue-500 mb-2">Outputs</p>
        <p class="text-2xl font-black text-blue-600 dark:text-blue-400">
          {{ project.outputs?.length || 0 }}
        </p>
      </div>
    </div>

    <!-- ===== OUTPUTS SUMMARY ===== -->
    @if (project.outputs?.length > 0) {
      <div
        class="bg-white dark:bg-[#111827] rounded-3xl border border-slate-100 dark:border-gray-800 shadow-sm overflow-hidden"
      >
        <div class="px-7 py-5 border-b border-slate-50 dark:border-gray-800">
          <h2
            class="text-xs font-black uppercase tracking-[0.2em] text-slate-400 dark:text-gray-500"
          >
            Outputs Summary
          </h2>
        </div>
        <div class="divide-y divide-slate-50 dark:divide-gray-800">
          @for (output of project.outputs; track output._id) {
            <div class="flex items-center justify-between px-7 py-4">
              <div class="flex items-center gap-3">
                <div
                  class="w-2 h-2 rounded-full flex-shrink-0"
                  [class.bg-emerald-500]="output.items?.length >= output.numberOfItems"
                  [class.bg-blue-500]="
                    output.items?.length > 0 && output.items?.length < output.numberOfItems
                  "
                  [class.bg-slate-300]="!output.items?.length"
                ></div>
                <span class="text-sm font-bold text-slate-700 dark:text-gray-300">{{
                  output.name
                }}</span>
              </div>
              <div class="flex items-center gap-4">
                <div class="w-24 h-1.5 bg-slate-100 dark:bg-gray-800 rounded-full overflow-hidden">
                  <div
                    class="h-full bg-blue-500 rounded-full transition-all"
                    [style.width.%]="
                      output.numberOfItems
                        ? ((output.items?.length || 0) / output.numberOfItems) * 100
                        : 0
                    "
                  ></div>
                </div>
                <span class="text-[10px] font-black text-slate-400 w-12 text-right"
                  >{{ output.items?.length || 0 }}/{{ output.numberOfItems }}</span
                >
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Charts -->
    <div class="grid lg:grid-cols-2 gap-6">
      <div
        class="p-8 rounded-3xl border shadow-sm bg-white border-slate-100 dark:bg-[#111827] dark:border-gray-800"
      >
        <app-chart-card
          title="Work Distribution"
          [type]="'doughnut'"
          [data]="pieData"
        ></app-chart-card>
      </div>
      <div
        class="p-8 rounded-3xl border shadow-sm bg-white border-slate-100 dark:bg-[#111827] dark:border-gray-800"
      >
        <app-chart-card title="Outputs Delivery" [type]="'line'" [data]="lineData"></app-chart-card>
      </div>
    </div>
  </div>
}

@if (!isLoading && !project) {
  <div class="min-h-screen flex flex-col items-center justify-center gap-4">
    <div class="text-5xl">üîç</div>
    <h2 class="text-sm font-black uppercase tracking-widest text-slate-700 dark:text-gray-300">
      Project Not Found
    </h2>
    <a
      routerLink="/client/projects"
      class="px-6 py-3 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest no-underline"
      >‚Üê Back</a
    >
  </div>
}
