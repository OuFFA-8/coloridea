<div class="min-h-screen bg-[#fff1e6] dark:bg-[#0e0e0e] transition-colors duration-500">
  <!-- ===== HERO / COVER ===== -->
  <div
    class="relative h-52 overflow-hidden"
    [style.backgroundImage]="
      patternPreview || (user?.pattern ? 'url(' + getPhotoUrl(user.pattern) + ')' : 'none')
    "
    style="background-size: cover; background-position: center; background-color: #e6d5c3"
  >
    <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
    <!-- Pattern Upload -->
    <label
      class="absolute top-4 right-4 px-3 py-1.5 rounded-xl backdrop-blur-sm border cursor-pointer transition-all flex items-center gap-2 bg-white/10 hover:bg-white/20 border-white/20 text-white text-[10px] font-black uppercase tracking-widest"
    >
      üñº {{ 'CLIENT.PROFILE.CHANGE_PHOTO' | translate }}
      <input
        type="file"
        class="hidden"
        accept="image/*"
        (change)="onFileSelected($event, 'pattern')"
      />
    </label>
  </div>

  <div class="max-w-3xl mx-auto px-6">
    <!-- ===== AVATAR + NAME ===== -->
    <div class="flex items-end justify-between -mt-16 mb-8">
      <div class="relative flex-shrink-0">
        <div
          class="w-28 h-28 rounded-3xl border-4 border-[#fff1e6] dark:border-[#0e0e0e] overflow-hidden shadow-xl bg-white dark:bg-[#1c1c1c]"
        >
          @if (photoPreview) {
            <img [src]="photoPreview" class="w-full h-full object-cover" />
          } @else if (user?.photo) {
            <img
              [src]="getPhotoUrl(user.photo)"
              class="w-full h-full object-cover"
              (error)="$any($event.target).style.display = 'none'"
            />
          } @else {
            <div class="w-full h-full flex items-center justify-center">
              <span class="text-4xl font-black text-[#e6d5c3]">{{ user?.name?.charAt(0) }}</span>
            </div>
          }
        </div>
        <label
          class="absolute -bottom-2 -right-2 w-8 h-8 rounded-xl flex items-center justify-center cursor-pointer shadow-lg transition-all bg-[#fa8728] hover:bg-[#f97316]"
        >
          <span class="text-white text-sm">üì∑</span>
          <input
            type="file"
            class="hidden"
            accept="image/*"
            (change)="onFileSelected($event, 'photo')"
          />
        </label>
      </div>

      <div class="ml-4 mb-2 flex-1">
        <h1
          class="text-2xl font-black text-[#444547] dark:text-white"
          style="font-family: 'Lexend', sans-serif"
        >
          {{ user?.name }}
        </h1>
        <p class="text-sm text-[#5c5f63]/50 dark:text-gray-500">{{ user?.email }}</p>
        <span
          class="inline-block mt-1 px-2.5 py-0.5 rounded-lg text-[9px] font-black uppercase tracking-widest"
          [class.bg-[#68ab1f]/15]="user?.isActive"
          [class.text-[#68ab1f]]="user?.isActive"
          [class.bg-[#e6d5c3]/60]="!user?.isActive"
          [class.text-[#5c5f63]/50]="!user?.isActive"
        >
          {{
            user?.isActive
              ? ('CLIENT.PROFILE.STATUS_ACTIVE' | translate)
              : ('CLIENT.PROFILE.STATUS_INACTIVE' | translate)
          }}
        </span>
      </div>
    </div>

    <!-- ===== TOAST ===== -->
    @if (successMsg) {
      <div
        class="mb-6 px-5 py-4 rounded-2xl flex items-center gap-3 bg-[#68ab1f]/10 border border-[#68ab1f]/25 dark:bg-[#68ab1f]/10 dark:border-[#68ab1f]/20"
      >
        <span class="text-[#68ab1f] text-lg">‚úì</span>
        <p class="text-sm font-bold text-[#68ab1f]">{{ successMsg }}</p>
      </div>
    }
    @if (errorMsg) {
      <div
        class="mb-6 px-5 py-4 rounded-2xl flex items-center gap-3 bg-rose-50 border border-rose-200 dark:bg-rose-500/10 dark:border-rose-500/20"
      >
        <span class="text-rose-500 text-lg">‚úï</span>
        <p class="text-sm font-bold text-rose-600 dark:text-rose-400">{{ errorMsg }}</p>
      </div>
    }

    <!-- ===== TABS ===== -->
    <div
      class="flex gap-1 p-1 rounded-2xl border shadow-sm mb-8 bg-white border-[#e6d5c3] dark:bg-[#1c1c1c] dark:border-[#444547]/30"
    >
      @for (
        tab of [
          { id: 'profile', label: 'CLIENT.PROFILE.TAB_PROFILE', icon: 'üë§' },
          { id: 'password', label: 'CLIENT.PROFILE.TAB_PASSWORD', icon: 'üîí' },
          { id: 'email', label: 'CLIENT.PROFILE.TAB_EMAIL', icon: '‚úâÔ∏è' },
        ];
        track tab.id
      ) {
        <button
          (click)="activeTab = $any(tab.id)"
          class="flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all duration-300 border-none cursor-pointer"
          [class.bg-[#fa8728]]="activeTab === tab.id"
          [class.text-white]="activeTab === tab.id"
          [class.shadow-lg]="activeTab === tab.id"
          [class.shadow-[#fa8728]/20]="activeTab === tab.id"
          [class.text-[#5c5f63]/50]="activeTab !== tab.id"
          [class.dark:text-gray-500]="activeTab !== tab.id"
          [class.bg-transparent]="activeTab !== tab.id"
        >
          <span>{{ tab.icon }}</span>
          <span class="hidden sm:inline">{{ tab.label | translate }}</span>
        </button>
      }
    </div>

    <!-- ===== TAB: PROFILE ===== -->
    @if (activeTab === 'profile') {
      <form [formGroup]="profileForm" class="space-y-8 pb-16">
        <!-- Basic Info -->
        <div
          class="ci-card bg-white dark:bg-[#1c1c1c] rounded-3xl border border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm p-7"
        >
          <h2
            class="text-[10px] font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500 mb-6 flex items-center gap-2"
          >
            <span class="w-4 h-[1px] bg-[#fa8728]"></span>
            {{ 'ADMIN.PROJECTS.BASIC_INFO' | translate }}
          </h2>
          <div class="space-y-4">
            <div class="space-y-1.5">
              <label
                class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500"
              >
                {{ 'CLIENT.PROFILE.NAME' | translate }}
              </label>
              <input formControlName="name" type="text" class="ci-input" />
            </div>
            <div class="space-y-1.5">
              <label
                class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500"
              >
                {{ 'CLIENT.PROFILE.EMAIL' | translate }}
              </label>
              <input
                [value]="user?.email"
                disabled
                type="text"
                class="ci-input !bg-[#e6d5c3]/40 dark:!bg-[#444547]/20 !text-[#5c5f63]/40 cursor-not-allowed"
              />
              <p class="text-[9px] text-[#5c5f63]/40 dark:text-gray-600">
                {{ 'CLIENT.PROFILE.EMAIL_HINT' | translate }}
              </p>
            </div>
          </div>
        </div>

        <!-- Brand Assets -->
        <div
          class="ci-card bg-white dark:bg-[#1c1c1c] rounded-3xl border border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm p-7"
        >
          <h2
            class="text-[10px] font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500 mb-6 flex items-center gap-2"
          >
            <span class="w-4 h-[1px] bg-[#fa8728]"></span>
            {{ 'CLIENT.PROFILE.BRAND_ASSETS' | translate }}
          </h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
            @for (
              asset of [
                {
                  key: 'logo',
                  icon: 'üè¢',
                  label: 'CLIENT.PROFILE.LOGO',
                  preview: logoPreview,
                  existing: user?.logo,
                  fit: 'contain',
                },
                {
                  key: 'pattern',
                  icon: 'üé®',
                  label: 'CLIENT.PROFILE.PATTERN',
                  preview: patternPreview,
                  existing: user?.pattern,
                  fit: 'cover',
                },
              ];
              track asset.key
            ) {
              <div class="space-y-2">
                <label
                  class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500"
                >
                  {{ asset.label | translate }}
                </label>
                <label
                  class="relative flex flex-col items-center justify-center h-36 rounded-2xl border-2 border-dashed cursor-pointer overflow-hidden transition-colors duration-300 border-[#e6d5c3] hover:border-[#fa8728] bg-[#fff1e6] dark:bg-[#444547]/10 dark:border-[#444547]/30 dark:hover:border-[#fa8728]"
                >
                  @if (asset.preview) {
                    <img
                      [src]="asset.preview"
                      class="w-full h-full"
                      [class.object-contain]="asset.fit === 'contain'"
                      [class.object-cover]="asset.fit === 'cover'"
                      [class.p-3]="asset.fit === 'contain'"
                    />
                  } @else if (asset.existing) {
                    <img
                      [src]="getPhotoUrl(asset.existing)"
                      class="w-full h-full"
                      [class.object-contain]="asset.fit === 'contain'"
                      [class.object-cover]="asset.fit === 'cover'"
                      [class.p-3]="asset.fit === 'contain'"
                      (error)="$any($event.target).style.display = 'none'"
                    />
                  } @else {
                    <div class="text-center opacity-30">
                      <span class="text-3xl">{{ asset.icon }}</span>
                      <p
                        class="text-[9px] font-black uppercase mt-1 text-[#5c5f63]/50 dark:text-gray-500"
                      >
                        {{ 'CLIENT.PROFILE.UPLOAD' | translate }}
                      </p>
                    </div>
                  }
                  <input
                    type="file"
                    class="hidden"
                    accept="image/*"
                    (change)="onFileSelected($event, $any(asset.key))"
                  />
                  <div
                    class="absolute bottom-2 right-2 px-2 py-1 rounded-lg text-[8px] font-black text-[#5c5f63]/50 dark:text-gray-500 bg-white/80 dark:bg-[#1c1c1c]/80 backdrop-blur-sm"
                  >
                    {{ 'CLIENT.PROFILE.CLICK_TO_CHANGE' | translate }}
                  </div>
                </label>
              </div>
            }
          </div>
        </div>

        <button
          type="button"
          (click)="saveProfile()"
          [disabled]="profileForm.invalid || isSavingProfile"
          class="w-full py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-white border-none cursor-pointer shadow-xl transition-all disabled:opacity-50 bg-[#fa8728] hover:bg-[#f97316] shadow-[#fa8728]/20"
        >
          {{
            isSavingProfile ? ('COMMON.LOADING' | translate) : ('CLIENT.PROFILE.SAVE' | translate)
          }}
        </button>
      </form>
    }

    <!-- ===== TAB: PASSWORD ===== -->
    @if (activeTab === 'password') {
      <form [formGroup]="passwordForm" class="space-y-6 pb-16">
        <div
          class="ci-card bg-white dark:bg-[#1c1c1c] rounded-3xl border border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm p-7 space-y-5"
        >
          <h2
            class="text-[10px] font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500 flex items-center gap-2"
          >
            <span class="w-4 h-[1px] bg-[#fa8728]"></span>
            {{ 'CLIENT.PROFILE.CHANGE_PASSWORD' | translate }}
          </h2>
          @for (
            field of [
              { name: 'currentPassword', label: 'CLIENT.PROFILE.CURRENT_PASSWORD' },
              { name: 'password', label: 'CLIENT.PROFILE.NEW_PASSWORD' },
              { name: 'confirmPassword', label: 'CLIENT.PROFILE.CONFIRM_PASSWORD' },
            ];
            track field.name
          ) {
            <div class="space-y-1.5">
              <label
                class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500"
              >
                {{ field.label | translate }}
              </label>
              <input [formControlName]="field.name" type="password" class="ci-input" />
            </div>
          }
        </div>
        <button
          type="button"
          (click)="savePassword()"
          [disabled]="passwordForm.invalid || isSavingPassword"
          class="w-full py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-white border-none cursor-pointer shadow-xl transition-all disabled:opacity-50 bg-[#fa8728] hover:bg-[#f97316] shadow-[#fa8728]/20"
        >
          {{
            isSavingPassword
              ? ('COMMON.LOADING' | translate)
              : ('CLIENT.PROFILE.UPDATE_PASSWORD' | translate)
          }}
        </button>
      </form>
    }

    <!-- ===== TAB: EMAIL ===== -->
    @if (activeTab === 'email') {
      <div class="space-y-6 pb-16">
        <div
          class="ci-card bg-white dark:bg-[#1c1c1c] rounded-3xl border border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm p-7"
        >
          <h2
            class="text-[10px] font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500 mb-1 flex items-center gap-2"
          >
            <span class="w-4 h-[1px] bg-[#fa8728]"></span>
            {{ 'CLIENT.PROFILE.CHANGE_EMAIL_TITLE' | translate }}
          </h2>
          <p class="text-xs text-[#5c5f63]/50 dark:text-gray-500 mb-6">
            {{ 'CLIENT.PROFILE.EMAIL_VERIFY_HINT' | translate }}
          </p>

          @if (!emailRequestSent) {
            <form [formGroup]="emailRequestForm" class="space-y-4">
              <div class="space-y-1.5">
                <label
                  class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500"
                >
                  {{ 'CLIENT.PROFILE.CURRENT_EMAIL' | translate }}
                </label>
                <input
                  [value]="user?.email"
                  disabled
                  type="text"
                  class="ci-input !bg-[#e6d5c3]/40 dark:!bg-[#444547]/20 !text-[#5c5f63]/40 cursor-not-allowed"
                />
              </div>
              <div class="space-y-1.5">
                <label
                  class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/50 dark:text-gray-500"
                >
                  {{ 'CLIENT.PROFILE.NEW_EMAIL' | translate }}
                </label>
                <input
                  formControlName="email"
                  type="email"
                  placeholder="new@email.com"
                  class="ci-input"
                />
              </div>
              <button
                type="button"
                (click)="requestEmailChange()"
                [disabled]="emailRequestForm.invalid || isSendingEmail"
                class="w-full py-3.5 rounded-2xl text-[10px] font-black uppercase tracking-widest text-white border-none cursor-pointer transition-all disabled:opacity-50 bg-[#fa8728] hover:bg-[#f97316]"
              >
                {{
                  isSendingEmail
                    ? ('COMMON.LOADING' | translate)
                    : ('CLIENT.PROFILE.VERIFY' | translate)
                }}
              </button>
            </form>
          } @else {
            <div class="text-center py-6">
              <div
                class="w-16 h-16 rounded-3xl flex items-center justify-center mx-auto mb-4 bg-[#fa8728]/10 dark:bg-[#fa8728]/10"
              >
                <span class="text-3xl">‚úâÔ∏è</span>
              </div>
              <h3
                class="text-base font-black text-[#444547] dark:text-white mb-2"
                style="font-family: 'Lexend', sans-serif"
              >
                {{ 'CLIENT.PROFILE.CHECK_INBOX' | translate }}
              </h3>
              <p class="text-xs text-[#5c5f63]/50 dark:text-gray-500 mb-1">
                {{ 'CLIENT.PROFILE.SENT_TO' | translate }}
              </p>
              <p class="text-sm font-black text-[#fa8728] mb-6">
                {{ emailRequestForm.value.email }}
              </p>
              <p
                class="text-[10px] text-[#5c5f63]/30 dark:text-gray-700 font-bold uppercase tracking-widest mb-4"
              >
                {{ 'CLIENT.PROFILE.CLICK_LINK' | translate }}
              </p>
              <button
                type="button"
                (click)="emailRequestSent = false"
                class="px-6 py-2.5 rounded-xl text-[10px] font-black uppercase text-[#5c5f63]/50 border-none cursor-pointer transition-all bg-[#e6d5c3]/40 hover:bg-[#e6d5c3]/70 dark:bg-[#444547]/20 dark:hover:bg-[#444547]/30"
              >
                ‚Üê {{ 'CLIENT.PROFILE.TRY_DIFFERENT' | translate }}
              </button>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
