<!-- ===== SKELETON ===== -->
@if (isLoading) {
  <div class="p-8 min-h-screen bg-[#fff1e6] dark:bg-[#0e0e0e]">
    <div class="animate-pulse space-y-6">
      <div class="flex justify-between">
        <div class="space-y-2">
          <div class="h-3 w-24 rounded-full bg-[#fa8728]/20"></div>
          <div class="h-8 w-64 rounded-xl bg-[#444547]/10 dark:bg-white/5"></div>
          <div class="h-3 w-48 rounded-full bg-[#444547]/5 dark:bg-white/5"></div>
        </div>
        <div class="h-10 w-28 rounded-xl bg-[#444547]/5 dark:bg-white/5"></div>
      </div>
      <div class="grid grid-cols-4 gap-5">
        @for (i of [1, 2, 3, 4]; track i) {
          <div class="h-36 rounded-2xl bg-white/60 dark:bg-white/5"></div>
        }
      </div>
      <div class="grid grid-cols-3 gap-5">
        <div class="col-span-2 grid grid-cols-2 gap-5">
          <div class="h-72 rounded-2xl bg-white/60 dark:bg-white/5"></div>
          <div class="h-72 rounded-2xl bg-white/60 dark:bg-white/5"></div>
        </div>
        <div class="h-72 rounded-2xl bg-white/60 dark:bg-white/5"></div>
      </div>
      <div class="h-64 rounded-2xl bg-white/60 dark:bg-white/5"></div>
    </div>
  </div>
}

<!-- ===== CONTENT ===== -->
@if (!isLoading) {
  <div
    class="p-8 min-h-screen relative overflow-hidden bg-[#fff1e6] dark:bg-[#0e0e0e] transition-colors duration-500"
  >
    <!-- Ambient glows -->
    <div
      class="pointer-events-none fixed top-[-20%] right-[-10%] w-[700px] h-[700px] rounded-full blur-[140px] z-0 bg-[#fa8728]/8 dark:bg-[#fa8728]/4"
    ></div>
    <div
      class="pointer-events-none fixed bottom-[-10%] left-[-5%] w-[500px] h-[500px] rounded-full blur-[120px] z-0 bg-[#444547]/5 dark:bg-[#2fa5a9]/3"
    ></div>

    <!-- ===== HEADER ===== -->
    <div class="relative z-10 flex items-start justify-between mb-8 ci-fade-up">
      <div>
        <span
          class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-[0.3em] mb-3 bg-[#fa8728]/10 dark:bg-[#fa8728]/10 text-[#fa8728] border border-[#fa8728]/20"
        >
          <span class="w-1.5 h-1.5 rounded-full bg-[#fa8728] animate-pulse inline-block"></span>
          {{ 'ADMIN.DASHBOARD.TITLE' | translate }}
        </span>
        <h1
          class="text-4xl font-black tracking-tight leading-tight text-[#444547] dark:text-white"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ 'ADMIN.DASHBOARD.TITLE' | translate }}
        </h1>
        <p
          class="text-sm mt-1 text-[#5c5f63]/60 dark:text-gray-500"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ 'ADMIN.DASHBOARD.SUBTITLE' | translate }}
        </p>
      </div>
      <button
        (click)="loadDashboard()"
        class="flex items-center gap-2 px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest cursor-pointer transition-all duration-300 bg-white dark:bg-[#1c1c1c] border border-[#e6d5c3] dark:border-[#444547]/40 text-[#444547] dark:text-gray-400 hover:border-[#fa8728] hover:text-[#fa8728] hover:shadow-lg hover:shadow-[#fa8728]/15 active:scale-95"
      >
        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2.5"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
          />
        </svg>
        {{ 'ADMIN.DASHBOARD.REFRESH' | translate }}
      </button>
    </div>

    <!-- ===== STAT CARDS ===== -->
    <div class="relative z-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-6">
      <!-- Clients -->
      <div
        routerLink="/admin/clients"
        class="ci-card ci-delay-1 group relative overflow-hidden rounded-2xl p-6 cursor-pointer bg-white dark:bg-[#1c1c1c] border border-[#e6d5c3] dark:border-[#444547]/30 transition-all duration-500 ease-out hover:-translate-y-1 hover:shadow-2xl hover:shadow-[#fa8728]/15 hover:border-[#fa8728]/40"
      >
        <!-- top accent line -->
        <div
          class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-[#fa8728] to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        ></div>
        <!-- bg icon -->
        <div
          class="absolute -right-3 -bottom-3 text-8xl opacity-[0.03] group-hover:opacity-[0.06] group-hover:scale-110 transition-all duration-500 select-none"
        >
          ðŸ‘¥
        </div>

        <div class="flex items-center justify-between mb-6">
          <div
            class="w-12 h-12 rounded-2xl flex items-center justify-center bg-[#fa8728]/10 border border-[#fa8728]/20 group-hover:scale-110 transition-transform duration-300"
          >
            <svg
              class="w-5 h-5 text-[#fa8728]"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"
              />
            </svg>
          </div>
          <span
            class="text-[9px] font-black uppercase tracking-widest px-2.5 py-1 rounded-lg text-[#fa8728] bg-[#fa8728]/8 border border-[#fa8728]/15"
          >
            {{ 'ADMIN.DASHBOARD.CLIENTS_LABEL' | translate }}
          </span>
        </div>
        <p
          class="text-[9px] font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500 mb-1"
        >
          {{ 'ADMIN.DASHBOARD.TOTAL_CLIENTS' | translate }}
        </p>
        <h2
          class="text-5xl font-black text-[#444547] dark:text-white leading-none"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ totalClients }}
        </h2>
      </div>

      <!-- Projects -->
      <div
        routerLink="/admin/projects"
        class="ci-card ci-delay-2 group relative overflow-hidden rounded-2xl p-6 cursor-pointer bg-white dark:bg-[#1c1c1c] border border-[#e6d5c3] dark:border-[#444547]/30 transition-all duration-500 ease-out hover:-translate-y-1 hover:shadow-2xl hover:shadow-[#444547]/15 hover:border-[#444547]/40"
      >
        <div
          class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-[#444547] to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        ></div>
        <div
          class="absolute -right-3 -bottom-3 text-8xl opacity-[0.03] group-hover:opacity-[0.06] group-hover:scale-110 transition-all duration-500 select-none"
        >
          ðŸ’¼
        </div>

        <div class="flex items-center justify-between mb-6">
          <div
            class="w-12 h-12 rounded-2xl flex items-center justify-center bg-[#444547]/8 dark:bg-[#444547]/20 border border-[#444547]/15 group-hover:scale-110 transition-transform duration-300"
          >
            <svg
              class="w-5 h-5 text-[#5c5f63] dark:text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              />
            </svg>
          </div>
          <span
            class="text-[9px] font-black uppercase tracking-widest px-2.5 py-1 rounded-lg text-[#5c5f63] dark:text-gray-400 bg-[#444547]/6 dark:bg-[#444547]/20 border border-[#444547]/10"
          >
            {{ 'ADMIN.DASHBOARD.PROJECTS_LABEL' | translate }}
          </span>
        </div>
        <p
          class="text-[9px] font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500 mb-1"
        >
          {{ 'ADMIN.DASHBOARD.TOTAL_PROJECTS' | translate }}
        </p>
        <h2
          class="text-5xl font-black text-[#444547] dark:text-white leading-none"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ totalProjects }}
        </h2>
      </div>

      <!-- Active -->
      <div
        class="ci-card ci-delay-3 group relative overflow-hidden rounded-2xl p-6 bg-white dark:bg-[#1c1c1c] border border-[#e6d5c3] dark:border-[#444547]/30 transition-all duration-500 ease-out hover:-translate-y-1 hover:shadow-2xl hover:shadow-[#2fa5a9]/15 hover:border-[#2fa5a9]/40"
      >
        <div
          class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-[#2fa5a9] to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        ></div>
        <div
          class="absolute -right-3 -bottom-3 text-8xl opacity-[0.03] group-hover:opacity-[0.06] group-hover:scale-110 transition-all duration-500 select-none"
        >
          âš¡
        </div>

        <div class="flex items-center justify-between mb-6">
          <div
            class="w-12 h-12 rounded-2xl flex items-center justify-center bg-[#2fa5a9]/10 border border-[#2fa5a9]/20 group-hover:scale-110 transition-transform duration-300"
          >
            <svg
              class="w-5 h-5 text-[#2fa5a9]"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"
              />
            </svg>
          </div>
          <span
            class="flex items-center gap-1.5 text-[9px] font-black uppercase tracking-widest px-2.5 py-1 rounded-lg text-[#2fa5a9] bg-[#2fa5a9]/8 border border-[#2fa5a9]/15"
          >
            <span class="w-1.5 h-1.5 rounded-full bg-[#2fa5a9] animate-pulse inline-block"></span>
            {{ 'ADMIN.DASHBOARD.LIVE' | translate }}
          </span>
        </div>
        <p
          class="text-[9px] font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500 mb-1"
        >
          {{ 'ADMIN.DASHBOARD.ACTIVE_PROJECTS' | translate }}
        </p>
        <h2
          class="text-5xl font-black text-[#444547] dark:text-white leading-none"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ activeProjects }}
        </h2>
      </div>

      <!-- Completed -->
      <div
        class="ci-card ci-delay-4 group relative overflow-hidden rounded-2xl p-6 bg-white dark:bg-[#1c1c1c] border border-[#e6d5c3] dark:border-[#444547]/30 transition-all duration-500 ease-out hover:-translate-y-1 hover:shadow-2xl hover:shadow-[#68ab1f]/15 hover:border-[#68ab1f]/40"
      >
        <div
          class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-[#68ab1f] to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        ></div>
        <div
          class="absolute -right-3 -bottom-3 text-8xl opacity-[0.03] group-hover:opacity-[0.06] group-hover:scale-110 transition-all duration-500 select-none"
        >
          âœ…
        </div>

        <div class="flex items-center justify-between mb-6">
          <div
            class="w-12 h-12 rounded-2xl flex items-center justify-center bg-[#68ab1f]/10 border border-[#68ab1f]/20 group-hover:scale-110 transition-transform duration-300"
          >
            <svg
              class="w-5 h-5 text-[#68ab1f]"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
          <span
            class="text-[9px] font-black uppercase tracking-widest px-2.5 py-1 rounded-lg text-[#68ab1f] bg-[#68ab1f]/8 border border-[#68ab1f]/15"
          >
            {{ completionRate }}%
          </span>
        </div>
        <p
          class="text-[9px] font-black uppercase tracking-[0.2em] text-[#5c5f63]/50 dark:text-gray-500 mb-1"
        >
          {{ 'ADMIN.DASHBOARD.COMPLETED' | translate }}
        </p>
        <h2
          class="text-5xl font-black text-[#444547] dark:text-white leading-none"
          style="font-family: 'Alexandria', sans-serif"
        >
          {{ completedProjects }}
        </h2>
      </div>
    </div>

    <!-- ===== CHARTS + BREAKDOWN ===== -->
    <div class="relative z-10 grid grid-cols-1 lg:grid-cols-3 gap-5 mb-6 ci-fade-up ci-delay-3">
      <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-5">
        <div
          class="rounded-2xl border p-5 bg-white dark:bg-[#1c1c1c] border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm"
        >
          <app-chart-card
            title="{{ 'ADMIN.DASHBOARD.TITLE' | translate }}"
            [type]="'doughnut'"
            [data]="pieData"
          ></app-chart-card>
        </div>
        <div
          class="rounded-2xl border p-5 bg-white dark:bg-[#1c1c1c] border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm"
        >
          <app-chart-card
            title="Progress Over Time"
            [type]="'line'"
            [data]="lineData"
          ></app-chart-card>
        </div>
      </div>

      <!-- Breakdown -->
      <div
        class="rounded-2xl border p-6 flex flex-col justify-between bg-white dark:bg-[#1c1c1c] border-[#e6d5c3] dark:border-[#444547]/30 shadow-sm"
      >
        <div>
          <p
            class="text-[9px] font-black uppercase tracking-[0.25em] text-[#5c5f63]/40 dark:text-gray-600 mb-6"
          >
            {{ 'ADMIN.DASHBOARD.PROJECT_BREAKDOWN' | translate }}
          </p>
          <div class="space-y-5">
            <div>
              <div class="flex justify-between mb-2">
                <span
                  class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63] dark:text-gray-400"
                >
                  {{ 'ADMIN.DASHBOARD.PENDING' | translate }}
                </span>
                <span class="text-[9px] font-black text-[#444547] dark:text-gray-300">{{
                  pendingProjects
                }}</span>
              </div>
              <div class="h-1.5 rounded-full overflow-hidden bg-[#e6d5c3] dark:bg-[#444547]/20">
                <div
                  class="h-full bg-[#5c5f63] rounded-full transition-all duration-1000"
                  [style.width.%]="totalProjects ? (pendingProjects / totalProjects) * 100 : 0"
                ></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between mb-2">
                <span class="text-[9px] font-black uppercase tracking-widest text-[#fa8728]">
                  {{ 'ADMIN.DASHBOARD.ACTIVE' | translate }}
                </span>
                <span class="text-[9px] font-black text-[#444547] dark:text-gray-300">{{
                  activeProjects
                }}</span>
              </div>
              <div class="h-1.5 rounded-full overflow-hidden bg-[#e6d5c3] dark:bg-[#444547]/20">
                <div
                  class="h-full bg-[#fa8728] rounded-full transition-all duration-1000"
                  [style.width.%]="totalProjects ? (activeProjects / totalProjects) * 100 : 0"
                ></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between mb-2">
                <span class="text-[9px] font-black uppercase tracking-widest text-[#68ab1f]">
                  {{ 'ADMIN.DASHBOARD.COMPLETED' | translate }}
                </span>
                <span class="text-[9px] font-black text-[#444547] dark:text-gray-300">{{
                  completedProjects
                }}</span>
              </div>
              <div class="h-1.5 rounded-full overflow-hidden bg-[#e6d5c3] dark:bg-[#444547]/20">
                <div
                  class="h-full bg-[#68ab1f] rounded-full transition-all duration-1000"
                  [style.width.%]="totalProjects ? (completedProjects / totalProjects) * 100 : 0"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pt-6 mt-6 border-t border-[#e6d5c3] dark:border-[#444547]/20">
          <p
            class="text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/40 dark:text-gray-600 mb-3"
          >
            {{ 'ADMIN.DASHBOARD.COMPLETION_RATE' | translate }}
          </p>
          <div class="flex items-end gap-1.5 mb-3">
            <span
              class="text-6xl font-black text-[#444547] dark:text-white leading-none"
              style="font-family: 'Alexandria', sans-serif"
              >{{ completionRate }}</span
            >
            <span class="text-2xl font-black text-[#fa8728] mb-1">%</span>
          </div>
          <div class="h-2 rounded-full overflow-hidden bg-[#e6d5c3] dark:bg-[#444547]/20">
            <div
              class="h-full rounded-full transition-all duration-1000"
              style="background: linear-gradient(90deg, #fa8728, #f97316)"
              [style.width.%]="completionRate"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== LATEST PROJECTS TABLE ===== -->
    <div
      class="relative z-10 rounded-2xl border overflow-hidden shadow-sm ci-fade-up ci-delay-4 bg-white dark:bg-[#1c1c1c] border-[#e6d5c3] dark:border-[#444547]/30"
    >
      <div
        class="px-6 py-5 flex justify-between items-center border-b border-[#e6d5c3] dark:border-[#444547]/20"
      >
        <div class="flex items-center gap-3">
          <div class="w-1 h-5 rounded-full bg-[#fa8728]"></div>
          <h3
            class="font-black text-[#444547] dark:text-white"
            style="font-family: 'Alexandria', sans-serif"
          >
            {{ 'ADMIN.DASHBOARD.LATEST_PROJECTS' | translate }}
          </h3>
        </div>
        <a
          routerLink="/admin/projects"
          class="text-[9px] font-black uppercase tracking-widest text-[#fa8728] hover:text-[#f97316] no-underline transition-colors"
        >
          {{ 'ADMIN.DASHBOARD.VIEW_ALL' | translate }} â†’
        </a>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead
            class="bg-[#fff1e6]/60 dark:bg-[#444547]/8 text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/40 dark:text-gray-600"
          >
            <tr>
              <th class="px-6 py-4 text-left">{{ 'ADMIN.DASHBOARD.PROJECT' | translate }}</th>
              <th class="px-6 py-4 text-left">{{ 'ADMIN.DASHBOARD.CLIENT' | translate }}</th>
              <th class="px-6 py-4 text-left">{{ 'ADMIN.DASHBOARD.STATUS' | translate }}</th>
              <th class="px-6 py-4 text-left">{{ 'ADMIN.DASHBOARD.OUTPUTS' | translate }}</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-[#e6d5c3]/40 dark:divide-[#444547]/15">
            @for (p of latestProjects; track p._id) {
              <tr
                class="group hover:bg-[#fff1e6]/60 dark:hover:bg-[#fa8728]/3 transition-colors cursor-pointer"
                [routerLink]="['/admin/projects', p._id]"
              >
                <td class="px-6 py-4">
                  <div class="flex items-center gap-3">
                    @if (p.photo) {
                      <div
                        class="w-9 h-9 rounded-xl overflow-hidden flex-shrink-0 bg-[#e6d5c3] dark:bg-[#444547]/30 border border-[#e6d5c3] dark:border-[#444547]/20"
                      >
                        <img
                          [src]="'/images/logo-10.png' + p.photo.replace(/\\/g, '/')"
                          [alt]="p.name"
                          class="w-full h-full object-cover"
                          (error)="$any($event.target).style.display = 'none'"
                        />
                      </div>
                    }
                    <span
                      class="font-black text-[#444547] dark:text-white truncate max-w-[180px] group-hover:text-[#fa8728] transition-colors"
                    >
                      {{ p.name }}
                    </span>
                  </div>
                </td>
                <td class="px-6 py-4 font-bold text-[#5c5f63] dark:text-gray-400">
                  {{ p.user?.name }}
                </td>
                <td class="px-6 py-4">
                  @if (p.status === 'active') {
                    <span
                      class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-[9px] font-black bg-[#fa8728]/10 text-[#fa8728] border border-[#fa8728]/15"
                    >
                      <span
                        class="w-1 h-1 rounded-full bg-[#fa8728] animate-pulse inline-block"
                      ></span>
                      {{ 'STATUS.ACTIVE' | translate }}
                    </span>
                  } @else if (p.status === 'completed') {
                    <span
                      class="px-2.5 py-1 rounded-lg text-[9px] font-black bg-[#68ab1f]/10 text-[#68ab1f] border border-[#68ab1f]/15"
                    >
                      {{ 'STATUS.COMPLETED' | translate }}
                    </span>
                  } @else {
                    <span
                      class="px-2.5 py-1 rounded-lg text-[9px] font-black bg-[#444547]/8 text-[#5c5f63] dark:text-gray-400 border border-[#444547]/10"
                    >
                      {{ 'STATUS.PENDING' | translate }}
                    </span>
                  }
                </td>
                <td class="px-6 py-4 font-bold text-[#5c5f63] dark:text-gray-400">
                  {{ p.outputs?.length || 0 }}
                </td>
              </tr>
            } @empty {
              <tr>
                <td
                  colspan="4"
                  class="px-6 py-16 text-center text-[9px] font-black uppercase tracking-widest text-[#5c5f63]/30 dark:text-gray-700"
                >
                  {{ 'ADMIN.DASHBOARD.NO_PROJECTS' | translate }}
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
}
